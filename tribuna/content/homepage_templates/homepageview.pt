<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="tribuna.content">
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main">
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++tribuna.theme/css/jquery-ui-1.10.3.custom.min.css"
            />
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.theme/js/jquery-ui-1.10.3.custom.min.js"
            ></script>

        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading"> Home page </h1>


        <div tal:replace="structure provider:plone.belowcontenttitle" />


        <div tal:replace="structure provider:plone.abovecontentbody" />

        <h2 i18n:translate="heading_sessions">Articles</h2>
        <script>
            var tableGrid = []
            $(document).ready(function() {
                var x = 150
                var y = 100
                for (var i = 0; i<7; i++) {
                    for (var j = 0; j<7; j++) {
                    tableGrid.push({"left": i*x, "top": j*y})
                    }
                }
            });
        </script>
        <div style="min-height: 800px" >
        <tal:block repeat="article view/articles">
            <tal:block tal:condition="view/is_text_view">
                <div id="${article/UID}" class="ui-widget-content text-view">
                    <h3>
                        <a tal:attributes="href article/absolute_url" tal:content="article/title" />
                   </h3>
                   <p tal:content="article/description" />
               </div>
           </tal:block>
           <tal:block tal:condition="not:view/is_text_view">
                <div id="${article/UID}" class="ui-widget-content drag-view">
                    <h3>
                        <a tal:attributes="href article/absolute_url" tal:content="article/title" />
                   </h3>
                       <img tal:attributes="src string:${article/absolute_url}/@@images/image/preview" />
                <p tal:content="article/description" />
                </div>

                <script>
                    function get_random_color() {
                        var letters = '0123456789ABCDEF'.split('');
                        var color = '#';
                        for (var i = 0; i < 6; i++ ) {
                            color += letters[Math.round(Math.random() * 15)];
                        }
                        return color;
                    }

                    $(function() {
                        var articleUID= "#${article/UID}"
                        var numRand = Math.floor(Math.random()*tableGrid.length);
                        $(articleUID).css({'margin-left': tableGrid[numRand]["left"]});
                        $(articleUID).css({'margin-top': tableGrid[numRand]["top"]});
                        // $(articleUID).css({'background-color': get_random_color()});
                        tableGrid.splice(numRand, 1);
                        $(articleUID).css({'position' : 'absolute'});
                        $(articleUID).draggable({stack: "div"});
                        $(articleUID).draggable( "option", "distance", 0 );

                        // Add the current height and width (defined by img) to the style, so the div doesn't shrink on hover. Need to add this on img.load, so it can always find the information
                        var image = $(articleUID).find('img')
                        image.load(function(){
                            var imageHeight = image.height();
                            var imageWidth = image.width();
                            console.info(imageHeight, imageWidth);
                            $(articleUID).css({'height': imageHeight})
                            $(articleUID).css({'width': imageWidth})
                        });
                    });
              </script>
            </tal:block>
        </tal:block>

        </div>
        <div tal:replace="structure provider:plone.belowcontentbody" />

    </tal:main-macro>
</metal:main>

</body>
</html>

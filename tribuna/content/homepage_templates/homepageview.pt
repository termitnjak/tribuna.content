<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="tribuna.content">

<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main">
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++tribuna.theme/css/jquery-ui-1.10.3.custom.min.css"
            />
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.theme/js/jquery-ui-1.10.3.custom.min.js"
            ></script>
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++tribuna.theme/css/jquery.galleryview-3.0.css"
            />
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.theme/js/jquery.galleryview-3.0.min.js"
            ></script>
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.theme/js/jquery.easing.1.3.js"
            ></script>
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.theme/js/jquery.timers-1.2.js"
            ></script>

        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading"> Home page </h1>


        <div tal:replace="structure provider:plone.belowcontenttitle" />


        <div tal:replace="structure provider:plone.abovecontentbody" />

        <h2 i18n:translate="heading_sessions">Articles</h2>
        <script>
            var tableGrid = []
            $(document).ready(function() {
                var x = 150
                var y = 100
                for (var i = 0; i<7; i++) {
                    for (var j = 0; j<7; j++) {
                    tableGrid.push({"left": i*x, "top": j*y})
                    }
                }
            });
        </script>
        <div id="homepage_div" style="min-height: 800px" >
         <tal:block tal:condition="python: view.is_text_view() == 'text'">
            <tal:block repeat="article view/articles">
                <div id="${article/UID}" class="ui-widget-content text-view">
                    <h3>
                        <a href="${context/absolute_url}/@@home-page?article=${article/tpURL}" tal:content="article/title" />
                   </h3>
                   <p tal:content="article/description" />
               </div>
            </tal:block>
        </tal:block>
        <tal:block tal:condition="python: view.is_text_view() == 'drag'">
            <tal:block repeat="article view/articles">
                <div id="${article/UID}" class="ui-widget-content drag-view">
                    <h3>
                        <a href="${context/absolute_url}/@@home-page?article=${article/tpURL}" tal:content="article/title" />
                   </h3>
                       <img tal:attributes="src string:${article/absolute_url}/@@images/image/preview" />
                <p tal:content="article/description" />
                </div>

                <script>
                    $(function() {
                        var articleUID= "#${article/UID}"
                        var numRand = Math.floor(Math.random()*tableGrid.length);
                        $(articleUID).css({'left': tableGrid[numRand]["left"]});
                        $(articleUID).css({'top': tableGrid[numRand]["top"]});
                        tableGrid.splice(numRand, 1);
                        $(articleUID).css({'position' : 'absolute'});
                        $(articleUID).draggable({containment: "parent", stack: "div"});
                        $(articleUID).draggable("option", "distance", 0 );

                        // We put a 1ms delay to draggable so we can still click on links
                        $(articleUID).draggable("option", "delay", 1);

                        // Add the current height and width (defined by img) to the style, so the div doesn't shrink on hover. Need to add this on img.load, so it can always find the information
                        var image = $(articleUID).find('img')
                        image.load(function(){
                            var imageHeight = image.height();
                            var imageWidth = image.width();
                            $(articleUID).css({'height': imageHeight})
                            $(articleUID).css({'width': imageWidth})
                        });
                    });
              </script>
            </tal:block>
        </tal:block>
            <tal:block tal:condition="python: view.is_text_view() == 'gallery'">
                <div>
                  <ul id="gallery">

                  <tal:block tal:repeat="article view/articles">
                    <li>

                      <img tal:attributes="src string:${article/absolute_url}/@@images/image; title article/title" />
                      <div class="gv-panel-content">

                          <h3  tal:content="article/title" />
                          <img tal:attributes="src string:${article/absolute_url}/@@images/image" />
                          <p tal:content="structure article/text" />
                      </div>

                    </li>
                  </tal:block>
                  </ul>
                </div>


            </tal:block>


        </div>
        <div tal:replace="structure provider:plone.belowcontentbody" />

    </tal:main-macro>
</metal:main>

</body>
</html>

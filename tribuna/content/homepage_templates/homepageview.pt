<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="tribuna.content">

<body>

<metal:block fill-slot="style_slot">
    <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++tribuna.diazotheme/css/jquery-ui-1.10.3.custom.min.css"
            />
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.diazotheme/js/jquery-ui-1.10.3.custom.min.js"
            ></script>
        <link rel="stylesheet" type="text/css"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="href string:${navroot}/++resource++tribuna.diazotheme/css/jquery.galleryview-3.0.css"
            />
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.diazotheme/js/jquery.galleryview-3.0.min.js"
            ></script>
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.diazotheme/js/jquery.easing.1.3.js"
            ></script>
        <script type="text/javascript"
            tal:define="navroot context/@@plone_portal_state/navigation_root_url"
            tal:attributes="src string:${navroot}/++resource++tribuna.diazotheme/js/jquery.timers-1.2.js"
            ></script>
</metal:block>
<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main">


<!--         <tal:block tal:replace="view/checkGET" /> -->
        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading"> Home page </h1>


        <div tal:replace="structure provider:plone.belowcontenttitle" />


        <div tal:replace="structure provider:plone.abovecontentbody" />

        <script>
            // var tableGrid = []
            // $(document).ready(function() {
            //     var x = 150
            //     var y = 100
            //     for (var i = 0; i<7; i++) {
            //         for (var j = 0; j<7; j++) {
            //         tableGrid.push({"left": i*x, "top": j*y})
            //         }
            //     }
            // });
        </script>
        <tal:block
            tal:define="has_one_tag view/only_one_tag;
                        class python: has_one_tag and 'half-width' or 'full-width'">
          <div id="tag-description-div" tal:condition="has_one_tag">
            <h2 i18n:translate="">Description</h2>
            ${view/tag_description}
          </div>
          <div id="homepage-div" tal:attributes="class class">
            <h2 i18n:translate="">Articles</h2>
            <script>
              $('#homepage-div').css({'height': ($(window).height() - $('#portal-top').height() - $('#edit-bar').height() - $('#content').height() - 25)});
            </script>
           <tal:block tal:condition="view/is_text_view">

              <div class="articles_intersection">
                <h3 i18n:translate="">Intersection</h3>
                <tal:block repeat="article view/articles_intersection">
                    <div id="${article/UID}" class="ui-widget-content text-view">
                        <div id="gallery-link">

                          <a tal:condition="python: article.portal_type == 'tribuna.content.article'" href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="article/title" />
                          <a tal:condition="python: article.portal_type == 'Discussion Item'" class="text-view" href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="structure article/getText" />

                        </div>
                     <p tal:condition="python: article.portal_type == 'tribuna.content.article'" class="text-view" tal:content="article/description" />
                     <p tal:condition="python: article.portal_type == 'tribuna.content.article'" class="content-type" style="color: red">članek</p>
                     <p tal:condition="python: article.portal_type == 'Discussion Item'" class="content-type" style="color: red">komentar</p>
                 </div>
                </tal:block>
              </div>

              <div class="articles_union">
                <h3 i18n:translate="">Union</h3>
                <tal:block repeat="article view/articles_union">
                    <div id="${article/UID}" class="ui-widget-content text-view">
                        <div id="gallery-link">

                          <a tal:condition="python: article.portal_type == 'tribuna.content.article'" href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="article/title" />
                          <a tal:condition="python: article.portal_type == 'Discussion Item'" class="text-view" href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="structure article/getText" />
                        </div>
                     <p tal:condition="python: article.portal_type == 'tribuna.content.article'" class="text-view" tal:content="article/description" />
                     <p tal:condition="python: article.portal_type == 'tribuna.content.article'" class="content-type" style="color: red">članek</p>
                     <p tal:condition="python: article.portal_type == 'Discussion Item'" class="content-type" style="color: red">komentar</p>

                    </div>
                </tal:block>
              </div>
          </tal:block>
          <tal:block tal:condition="not: view/is_text_view">
              <tal:block repeat="article view/articles_all">
                  <div id="${article/UID}" class="ui-widget-content drag-view">
                    <img tal:condition="python: article.portal_type == 'tribuna.content.article'" tal:attributes="src string:${article/absolute_url}/@@images/image/preview" />
                    <div id="text">
                      <div id="gallery-link">
                        <a href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="article/title" />
                        <a tal:condition="python: article.portal_type == 'Discussion Item'" class="text-view" href="${context/absolute_url}/@@main-page?article=${article/id}" tal:content="structure article/getText" />
                      </div>
                      <p tal:condition="python: article.portal_type == 'tribuna.content.article'" class="drag-view" tal:content="article/description" />
                    </div>
                  </div>

                  <script>
                      $(function() {
                        console.info("Badum badum");
                          var articleUID= "#${article/UID}";
                          // var numRand = Math.floor(Math.random()*tableGrid.length);
                          // $(articleUID).css({'left': tableGrid[numRand]["left"]});
                          // $(articleUID).css({'top': tableGrid[numRand]["top"]});
                          // tableGrid.splice(numRand, 1);
                          $(articleUID).css({'position' : 'absolute'});
                          $(articleUID).draggable({containment: "parent", stack: "div", cancel: "h3" });
                          $(articleUID).draggable("option", "distance", 0 );

                          // Add the current height and width (defined by img) to the style, so the div doesn't shrink on hover. Need to add this on img.load, so it can always find the information
                          var image = $(articleUID).find('img')
                          console.info(image)
                          image.load(function(){
                              console.info("Dogaja!");
                              var imageHeight = image.height();
                              var imageWidth = image.width();
                              var numRandx = Math.floor(Math.random() * ($('#homepage-div').width() - imageWidth));
                              var numRandy = Math.floor(Math.random() * ($('#homepage-div').height() - imageHeight));

                              if(numRandx < 0) {
                                numRandx = 0;
                              }
                              if(numRandy < 0) {
                                numRandy = 0;
                              }

                              $(articleUID).css({'height': imageHeight});
                              $(articleUID).css({'width': imageWidth});
                              $(articleUID).css({'left': numRandx});
                              $(articleUID).css({'top': numRandy});
                              console.info($('#homepage-div').width(), $('#homepage-div').height(), imageWidth, imageHeight, numRandx, numRandy);
                          });
                          image.one('load', function() {
                            console.info('Image Loaded');
                          }).each(function() {
                            if(this.complete) $(this).load();
                          });
                      });
                </script>
              </tal:block>
          </tal:block>
          </div>
        </tal:block>
        <script type="text/javascript">
          jQuery(function($){
          //   $('#form-buttons-gallery input').prepOverlay(
          //       {
          //           subtype: 'ajax',
          //           filter: common_content_filter,
          //           formselector: 'form.kssattr-formname-my-form, form[name="groups"]',
          //           noform: function(el) {return $.plonepopups.noformerrorshow(el, 'redirect');},
          //           redirect: function () {return location.href;}
          //       }
          //   );


            $('#gallery-link a').prepOverlay({
              subtype: 'iframe',
              width: '95%'
            });
          });

          // $(window).resize(function() {
          //   console.info("Hablahabla");
          // });

          $(window).resize(function() {
              // console.info("Resized outer!");
              $('iframe').attr('width', $(window).width()*0.95);
          });
        </script>

        <div tal:replace="structure provider:plone.belowcontentbody" />
    </tal:main-macro>
</metal:main>


</body>
</html>
